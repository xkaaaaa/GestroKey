# GestroKey - 手势控制应用

GestroKey是一个基于PyQt5开发的手势控制应用程序，它允许用户通过定义和使用鼠标手势来控制Windows系统和应用程序。

## 主要功能

- **手势识别**: 识别用户绘制的鼠标手势并触发相应操作
- **操作控制**: 控制窗口最大化、最小化、前后切换等系统操作
- **自定义手势**: 允许用户创建和管理自定义手势
- **直观的用户界面**: 现代、简洁的用户界面，使用PyQt5构建
- **绘画效果优化**: 平滑的笔画绘制和渐隐动画效果
- **资源优化**: 使用对象池管理绘图对象，减少内存占用
- **高性能渲染**: 支持硬件加速和批量绘制，提高绘图性能

## 安装要求

1. Python 3.8+
2. 依赖库：见`requirements.txt`文件

## 安装步骤

```bash
# 克隆仓库
git clone https://github.com/xkaaaaa/GestroKey.git

# 进入项目目录
cd GestroKey

# 安装依赖
pip install -r requirements.txt
```

## 使用说明

1. **启动应用**：
   ```bash
   python src/main.py
   ```
   或使用调试模式:
   ```bash
   python src/main.py -d
   ```

2. **绘制手势**：按住鼠标右键并拖动以绘制手势
3. **管理手势**：在"手势管理"标签页中添加、编辑或删除手势
4. **调整设置**：在"设置"标签页中调整应用参数

## 项目结构与文件说明

```
src/
├── app/                        # 应用核心功能
│   ├── __init__.py             # 包初始化文件
│   ├── _init_app.py            # 应用初始化模块，负责初始化应用环境
│   ├── gesture_parser.py       # 手势解析模块，处理手势识别逻辑
│   ├── ink_painter.py          # 墨水绘图模块，处理屏幕上的笔迹绘制
│   ├── log.py                  # 日志系统，提供全局日志功能
│   └── operation_executor.py   # 操作执行器，执行手势对应的操作
│
├── ui/                         # 用户界面组件
│   ├── assets/                 # 静态资源文件
│   │   └── icons/              # 图标资源
│   │       ├── internal/       # 内部使用的图标
│   │       │   ├── arrow_down.svg      # 下拉箭头图标
│   │       │   └── checkbox_checked.svg # 复选框图标
│   │       ├── close.svg               # 关闭按钮图标
│   │       ├── console.svg             # 控制台图标
│   │       ├── gestures.svg            # 手势图标
│   │       ├── icons.qrc               # Qt资源文件
│   │       ├── logo.svg                # 应用logo
│   │       ├── maximize.svg            # 最大化按钮图标
│   │       ├── minimize.svg            # 最小化按钮图标
│   │       ├── restore.svg             # 还原按钮图标
│   │       └── settings.svg            # 设置图标
│   │
│   ├── components/             # UI组件
│   │   ├── __init__.py                 # 组件包初始化文件
│   │   ├── title_bar.py                # 自定义标题栏组件
│   │   ├── tray_icon_manager.py        # 系统托盘图标管理器
│   │   └── window_resize_handler.py    # 窗口大小调整处理器
│   │
│   ├── pages/                  # 页面组件
│   │   ├── __init__.py                 # 页面包初始化文件
│   │   ├── console_page.py             # 控制台页面
│   │   ├── gestures_page.py            # 手势管理页面
│   │   └── settings_page.py            # 设置页面
│   │
│   ├── utils/                  # UI工具类
│   │   ├── __init__.py                 # 工具包初始化文件
│   │   ├── gesture_manager.py          # 手势管理器，处理手势的保存和加载
│   │   ├── icon_utils.py               # 图标工具，处理图标转换
│   │   ├── resource_manager.py         # 资源管理器，处理Qt资源
│   │   ├── settings_manager.py         # 设置管理器，处理应用设置
│   │   └── style_manager.py            # 样式管理器，处理应用主题和样式
│   │
│   ├── __init__.py             # UI包初始化文件
│   ├── main_window_new.py      # 主窗口组件，应用的主界面
│   ├── sidebar.py              # 侧边栏组件，用于导航
│   └── splash_screen.py        # 启动屏幕组件，显示启动进度
│
├── gestures.json               # 手势配置文件，存储用户定义的手势
├── settings.json               # 应用设置文件，存储用户的应用配置
├── version.py                  # 版本信息文件，包含应用版本号和版权信息
└── main.py                     # 应用入口点
```

## 核心组件详细说明

### 应用核心模块 (src/app/)

- **gesture_parser.py**: 
  - 手势解析器，负责将鼠标轨迹转化为方向序列
  - 提供手势匹配功能，将识别到的方向序列与预定义手势进行匹配
  - 支持不同格式的手势定义（列表格式和字符串格式）

- **ink_painter.py**: 
  - 墨水绘图引擎，处理鼠标轨迹的实时渲染
  - 提供平滑绘图算法，确保手势绘制流畅
  - 实现渐隐效果，增强用户体验
  - 捕获鼠标事件并记录轨迹点
  - 触发手势识别流程

- **log.py**: 
  - 全局日志系统，提供统一的日志记录机制
  - 支持异步日志，提高性能
  - 提供不同级别的日志记录（DEBUG、INFO、WARNING、ERROR）
  - 支持日志文件轮转，避免日志文件过大

- **operation_executor.py**: 
  - 操作执行器，负责执行识别到的手势对应的操作
  - 支持系统命令、快捷键操作等多种操作类型
  - 使用多进程执行操作，避免阻塞主线程

- **_init_app.py**: 
  - 应用初始化模块，负责初始化应用环境
  - 加载配置文件和初始化核心组件
  - 检查系统环境和资源准备

### 用户界面模块 (src/ui/)

#### 页面组件 (src/ui/pages/)

- **console_page.py**: 
  - 控制台页面，显示应用日志和状态信息
  - 提供系统资源监控功能
  - 显示调试信息和运行时数据

- **gestures_page.py**: 
  - 手势管理页面，用于创建、编辑和删除手势
  - 提供手势测试功能
  - 支持导入/导出手势配置

- **settings_page.py**: 
  - 设置页面，允许用户自定义应用行为
  - 提供主题切换、性能设置等选项
  - 支持设置的实时应用和保存

#### UI组件 (src/ui/components/)

- **title_bar.py**: 
  - 自定义窗口标题栏，替代系统默认标题栏
  - 提供窗口控制按钮（最小化、最大化、关闭）
  - 支持窗口拖动和双击最大化

- **tray_icon_manager.py**: 
  - 系统托盘图标管理器，提供最小化到托盘功能
  - 支持托盘菜单和托盘通知
  - 允许通过托盘图标控制应用

- **window_resize_handler.py**: 
  - 窗口大小调整处理器，实现自定义窗口边框调整功能
  - 提供边角拖动调整窗口大小的功能
  - 优化调整手感和视觉反馈

#### 工具类 (src/ui/utils/)

- **gesture_manager.py**: 
  - 手势管理器，处理手势的加载、保存和验证
  - 提供手势CRUD操作和事件通知
  - 管理手势配置文件

- **icon_utils.py**: 
  - 图标工具类，处理SVG转ICO等格式转换
  - 提供图标缓存功能，优化性能
  - 支持动态图标生成

- **resource_manager.py**: 
  - 资源管理器，处理Qt资源文件的加载和注册
  - 提供资源路径解析和资源加载功能
  - 管理应用静态资源

- **settings_manager.py**: 
  - 设置管理器，处理应用配置的加载和保存
  - 提供设置的默认值和验证机制
  - 支持设置变更的事件通知

- **style_manager.py**: 
  - 样式管理器，处理应用主题和样式
  - 提供全局样式表和组件样式设置
  - 支持主题切换和样式自定义

#### 其他UI组件

- **main_window_new.py**: 
  - 应用主窗口，整合所有UI组件
  - 管理页面切换和应用状态
  - 处理全局快捷键和事件

- **sidebar.py**: 
  - 侧边栏组件，提供页面导航功能
  - 支持展开/折叠动画效果
  - 显示当前选中页面状态

- **splash_screen.py**: 
  - 启动屏幕，显示应用启动进度
  - 提供视觉反馈，增强用户体验
  - 显示应用加载状态

### 配置文件

- **gestures.json**: 
  - 存储用户定义的手势配置
  - 包含手势名称、方向序列和对应操作

- **settings.json**: 
  - 存储应用全局设置
  - 包含用户界面、性能和行为配置

- **version.py**: 
  - 定义应用版本号和版权信息
  - 提供关于信息文本生成功能

- **main.py**: 
  - 应用入口点，处理命令行参数
  - 初始化应用环境和核心组件
  - 创建并显示主窗口

## 手势识别原理

GestroKey使用方向序列匹配算法识别手势，通过以下步骤处理：

1. 捕获鼠标轨迹点
2. 对轨迹点进行平滑和简化处理
3. 将平滑后的轨迹转换为方向序列（上、下、左、右等八个基本方向）
4. 优化方向序列（合并短笔画，识别重复模式，强化首尾）
5. 将优化后的方向序列与预定义手势库进行匹配
6. 执行匹配到的手势对应的操作（通过 Base64 编码的操作指令）

## 主要特点与技术实现

- **高性能绘图**:
  - 使用Qt的绘图API进行高效绘制
  - 批量处理绘图操作，减少绘制开销
  - 使用对象池管理绘图对象，减少内存占用和GC压力

- **智能平滑算法**:
  - 自适应采样，根据绘制速度调整采样率
  - 道格拉斯-普克算法简化轨迹点
  - 基于速度的线宽调整，实现更自然的笔迹效果

- **资源管理优化**:
  - 使用缓存减少配置文件的重复加载
  - 延迟初始化核心组件，减少启动时间
  - 组件间松耦合设计，提高扩展性

- **用户体验增强**:
  - 平滑的渐隐动画效果
  - 响应式UI设计，适应不同分辨率
  - 自定义窗口装饰，提供现代外观

## 贡献指南

欢迎贡献代码、报告问题或提出新功能建议。请fork本仓库并提交PR。

## 许可证

本项目使用GNU通用公共许可证第3版（GPLv3）- 详见LICENSE文件 